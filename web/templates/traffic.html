<canvas style="width: 100%;height:94px;margin-bottom: 15px" id="chart-os-in"></canvas>
<canvas style="width: 100%;height:94px;margin-bottom: 15px" id="chart-os-out"></canvas>
<canvas style="width: 100%;height:94px;margin-bottom: 15px" id="chart-os-in-n"></canvas>
<canvas style="width: 100%;height:94px;margin-bottom: 15px" id="chart-os-out-n"></canvas>
<script>
    trafficHandlerSocket();

    function trafficHandlerSocket() {
        let ws;
        try {
            ws = new WebSocket((window.location.protocol === "https:" ? "wss://" : "ws://") + window.location.host + "/traffic.io");
        } catch (e) {
            console.log(e);
            return
        }
        ws.onmessage = function (evt) {
            let data = JSON.parse(evt.data);
            if (document.getElementById("chart-os-in") != null) {
                lineChart(document.getElementById("chart-os-in"), data.os_in.reverse());
                lineChart(document.getElementById("chart-os-out"), data.os_out.reverse());
                lineChart(document.getElementById("chart-os-in-n"), data.os_in_n.reverse());
                lineChart(document.getElementById("chart-os-out-n"), data.os_out_n.reverse());
                ws.send("");
                document.getElementById("popup-window-title").querySelector("small").innerText = (data.os_in[data.os_in.length-1]).fileSizeH()+" / "+(data.os_out[data.os_out.length-1]).fileSizeH()
            } else {
                ws.onclose()
            }
        };
        ws.onopen = function () {
            if (ws.readyState !== 1) {
                return;
            }
            ws.send("");
        };
        ws.onerror = function () {
            ws && ws.close();
        };
        ws.onclose = function () {
            ws && ws.close();
        };
    }
</script>